---
title: Ubuntu系OS本体におけるストレージ補正
description: 
published: true
date: 2024-05-01T04:19:31.117Z
tags: server, ubuntu
editor: markdown
dateCreated: 2023-04-07T23:13:18.191Z
---

:warning: この記事はGoogleキャッシュからサルベージしました。(4月以前に投稿された記事です)

# Ubuntu系OS本体におけるストレージ補正

インストールの段階で指定をしていない限り、これらのOSはOS特有のファイルシステムをストレージ内に作成する。

VPSの場合はしっかり対策を取られていることが多いが、自宅サーバーの場合は自己管理しないといけないので、デフォルトのままだと実ストレージの最大容量までパーテーションを組まないことがある。

要するに1TBのHDDを使ってるのに、100GBしかパーテーションが取られていないということになる。

今回は僕自身がこのトラブルに直面したので、備忘録をここに残しておく

## 手順

①まず、現在のディスクの使用領域を確認する。

df -h

tpms内にあるデータが現状OS内で動かしているシステム領域となる。

ここで表示されるストレージが自分が導入したストレージよりも明らかに少ない場合補正が必要となる。

※ちなみに、日頃の疲れからかうっかり導入時のストレージ容量を忘れた企業戦士は以下のコマンドを打ち込むとマウントしている実ストレージ容量が確認出来て幸せになれる。

lsblk

②ファイルシステムを確認する

Linuxはストレージのパーテショニングを行う際に、独自のファイルシステムを採用する。しかし、標準のファイルシステムの場合、ストレージを拡張する場合に難渋することが多いので、LVM（倫理ボリューム管理）形式に修正するほうがいい。

まず、現在のファイルシステムを確認する。

sudo fdisk -l

③上の処理でコマンドの右側に出てくるファイルシステムが、LVMでない場合は修正する。

sudo fdisk /dev/sda

fdiskというUNIX系のパーテーション操作コマンドを使用して、独自ファイルシステムからLVMに入れ替える

コマンドを入力すると、会話形式で処理が遂行されるので以下の手順で進める

コマンド (mでヘルプ):t

// tはファイルタイプを変更することを表す

パーティション番号 (1-3,既定値 3):3

//ファイルタイプを導入時に変更していない限り3を選ぶ

パーティションのタイプ (Lで利用可能なタイプを一覧表示します):31

//Lを打ち込んでLVMに該当するものを選ぶ。Ubuntuの場合は31

コマンド (mでヘルプ):w

//wを選ぶと、変更が適用される。
④処理が終わった時点でファイルシステムが適用されたか確認する。

sudo fdisk -l

⑤LVMに合わせたファイル拡張を行う。

sudo resize2fs /dev/mapper/ubuntu--vg-ubuntu--lv

mapper以下は各OSで分かれるので適宜修正する。

このコマンドを処理した際のコマンドで次の行動が分岐するので注意されたい。

### The filesystem is already hogehoge (4k) blocks long. の場合

この場合ストレージの補正が成功したことになるので、適宜df -hなどで確認をかけてrebootする。

### The filesystem is already hogehoge (4k) blocks long. Nothing to do!

この場合は、ファイルシステムの拡張処理でコケてしまったことを表す。

既にファイルシステムが存在している論理ボリュームを上手に処理できなかった際に出る現象なので、管理者権限を使い、以下のコマンドを入力して対処する。

sudo lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv

この処理が終わった後に、再び以下のコマンドを入力すると、成功した旨の記載が表示される

sudo resize2fs /dev/mapper/ubuntu--vg-ubuntu--lv

## 余談

こういう面倒くさいことにならないために、システムファイルを作成する初めの段階で手動でしっかりパーテショニングをしておいた方がいいなと後悔した。

おあー疲れた！